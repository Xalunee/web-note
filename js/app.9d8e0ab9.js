(function(){"use strict";var e={1137:function(e,o,t){var r=t(9242),a=t(3396);const s={class:"container vh-100 vw-100 text-center"},n=(0,a._)("h1",null,"Заметки",-1),l=[n],i={class:"container d-flex justify-content-center align-items-center vh-100 vw-100"},c={class:"step"},u={class:"mb-3"},m=(0,a._)("label",{for:"name",class:"form-label"},"Имя",-1),f={class:"mb-3"},d=(0,a._)("label",{for:"password",class:"form-label"},"Пароль",-1),p=(0,a._)("button",{type:"submit",class:"btn btn-primary mb-1"},"Войти",-1),g={class:"step"},h={class:"mb-3"},w=(0,a._)("label",{for:"name",class:"form-label"},"Имя",-1),b={class:"mb-3"},v=(0,a._)("label",{for:"email",class:"form-label"},"Почта",-1),k={class:"mb-3"},_=(0,a._)("label",{for:"password",class:"form-label"},"Пароль",-1),y={class:"mb-3"},S=(0,a._)("label",{for:"confirmPassword",class:"form-label"},"Повторить пароль",-1),T=(0,a._)("button",{type:"submit",class:"btn btn-primary mb-1"},"Зарегистрироваться",-1);function z(e,o,t,n,z,A){return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.wy)((0,a._)("div",s,l,512),[[r.F8,0===z.step]]),(0,a._)("div",i,[(0,a.wy)((0,a._)("form",{onSubmit:o[3]||(o[3]=(0,r.iM)(((...e)=>A.autorizationUser&&A.autorizationUser(...e)),["prevent"])),novalidate:"",class:"border p-5 rounded"},[(0,a._)("div",c,[(0,a._)("div",u,[m,(0,a.wy)((0,a._)("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>n.state.formAutoriz.name=e),type:"text",class:"form-control",id:"name"},null,512),[[r.nr,n.state.formAutoriz.name]])]),(0,a._)("div",f,[d,(0,a.wy)((0,a._)("input",{"onUpdate:modelValue":o[1]||(o[1]=e=>n.state.formAutoriz.password=e),type:"password",class:"form-control",id:"password"},null,512),[[r.nr,n.state.formAutoriz.password]])]),p,(0,a._)("p",null,[(0,a.Uk)("Нет аккаунта? "),(0,a._)("span",{onClick:o[2]||(o[2]=(...e)=>A.register&&A.register(...e)),role:"button",class:"text-primary"},"Зарегистрироваться")])])],544),[[r.F8,1===z.step]]),(0,a.wy)((0,a._)("form",{onSubmit:o[9]||(o[9]=(0,r.iM)(((...e)=>A.registrationUser&&A.registrationUser(...e)),["prevent"])),novalidate:"",class:"border p-5 rounded"},[(0,a._)("div",g,[(0,a._)("div",h,[w,(0,a.wy)((0,a._)("input",{"onUpdate:modelValue":o[4]||(o[4]=e=>n.state.formReg.name=e),type:"text",class:"form-control",id:"name"},null,512),[[r.nr,n.state.formReg.name]])]),(0,a._)("div",b,[v,(0,a.wy)((0,a._)("input",{"onUpdate:modelValue":o[5]||(o[5]=e=>n.state.formReg.email=e),type:"email",class:"form-control",id:"email"},null,512),[[r.nr,n.state.formReg.email]])]),(0,a._)("div",k,[_,(0,a.wy)((0,a._)("input",{"onUpdate:modelValue":o[6]||(o[6]=e=>n.state.formReg.password=e),type:"password",class:"form-control",id:"password"},null,512),[[r.nr,n.state.formReg.password]])]),(0,a._)("div",y,[S,(0,a.wy)((0,a._)("input",{"onUpdate:modelValue":o[7]||(o[7]=e=>n.state.formReg.confirmPassword=e),type:"password",class:"form-control",id:"confirmPassword"},null,512),[[r.nr,n.state.formReg.confirmPassword]])]),T,(0,a._)("p",null,[(0,a.Uk)("У меня уже есть аккаунт. "),(0,a._)("span",{onClick:o[8]||(o[8]=(...e)=>A.autorization&&A.autorization(...e)),role:"button",class:"text-primary"},"Войти")])])],544),[[r.F8,2===z.step]])])],64)}var A=t(3053),R=t(9117),P=t(4870),U=t(70),x={setup(){const e=(0,P.qj)({formAutoriz:{name:"",password:""},formReg:{name:"",email:"",password:"",confirmPassword:""}}),o=(0,a.Fl)((()=>({formAutoriz:{name:{required:R.C1},password:{required:R.C1}},formReg:{name:{required:R.C1,maxLength:(0,R.BS)(32)},email:{required:R.C1,email:R.Do},password:{required:R.C1,minLength:(0,R.Ei)(6),maxLength:(0,R.BS)(32)},confirmPassword:{required:R.C1,sameAs:(0,R.sH)(e.formReg.password)}}}))),t=(0,A.Xw)(o,e);return{state:e,v$:t}},data(){return{step:1}},mounted(){localStorage.accessToken&&(this.step=0,U.ZP.post("https://test-api.misaka.net.ru/api/Account/login",{username:localStorage.userName,password:localStorage.userPassword}).then((function(e){console.log("Ответ сервера успешно получен!"),localStorage.accessToken=e.data.accessToken,localStorage.refreshToken=e.data.refreshToken})).catch((()=>{console.log("Пользователь не найден")})),setInterval((()=>{U.ZP.post("https://test-api.misaka.net.ru/api/Account/refresh-token",{refreshToken:localStorage.refreshToken}).then((function(e){console.log("Загрузка токенов в localStorage"),localStorage.accessToken=e.data.accessToken,localStorage.refreshToken=e.data.refreshToken})).catch((()=>{console.log("Токен не загрузился")}))}),9e5),U.ZP.get("https://test-api.misaka.net.ru/api/Account/user",{headers:{Authorization:`Bearer ${localStorage.accessToken}`}}).then((function(e){console.log(e.data.email),console.log(e.data.id),console.log(e.data.username)})).catch((()=>{console.log("Невозможно загрузить информацию о пользователе")})))},methods:{register(){1===this.step&&this.step++},autorization(){2===this.step&&this.step--},autorizationUser(){if(this.v$.$validate(),this.v$.formAutoriz.$error)console.log("Авторизация прошла неудачно");else{const e={name:this.state.formAutoriz.name,password:this.state.formAutoriz.password};U.ZP.post("https://test-api.misaka.net.ru/api/Account/login",{username:this.state.formAutoriz.name,password:this.state.formAutoriz.password}).then((function(o){console.log("Ответ сервера успешно получен!"),localStorage.accessToken=o.data.accessToken,localStorage.refreshToken=o.data.refreshToken,localStorage.userName=e.name,localStorage.userPassword=e.password,location.reload(),this.step=0})).catch((()=>{console.log("Пользователь не найден")}))}},registrationUser(){if(this.v$.$validate(),this.v$.formReg.$error)console.log("Регистрация прошла неудачно");else{const e={name:this.state.formReg.name,password:this.state.formReg.password};U.ZP.post("https://test-api.misaka.net.ru/api/Account/register",{username:this.state.formReg.name,email:this.state.formReg.email,password:this.state.formReg.password}).then((function(o){console.log("Ответ с сервера успешно получен"),localStorage.accessToken=o.data.accessToken,localStorage.refreshToken=o.data.refreshToken,localStorage.userName=e.name,localStorage.userPassword=e.password,location.reload(),this.step=0})).catch((()=>{console.log("Пользователь зарегистрирован")}))}}}},O=t(89);const C=(0,O.Z)(x,[["render",z]]);var $=C;(0,r.ri)($).mount("#app")}},o={};function t(r){var a=o[r];if(void 0!==a)return a.exports;var s=o[r]={exports:{}};return e[r](s,s.exports,t),s.exports}t.m=e,function(){var e=[];t.O=function(o,r,a,s){if(!r){var n=1/0;for(u=0;u<e.length;u++){r=e[u][0],a=e[u][1],s=e[u][2];for(var l=!0,i=0;i<r.length;i++)(!1&s||n>=s)&&Object.keys(t.O).every((function(e){return t.O[e](r[i])}))?r.splice(i--,1):(l=!1,s<n&&(n=s));if(l){e.splice(u--,1);var c=a();void 0!==c&&(o=c)}}return o}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[r,a,s]}}(),function(){t.n=function(e){var o=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(o,{a:o}),o}}(),function(){t.d=function(e,o){for(var r in o)t.o(o,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:o[r]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)}}(),function(){var e={143:0};t.O.j=function(o){return 0===e[o]};var o=function(o,r){var a,s,n=r[0],l=r[1],i=r[2],c=0;if(n.some((function(o){return 0!==e[o]}))){for(a in l)t.o(l,a)&&(t.m[a]=l[a]);if(i)var u=i(t)}for(o&&o(r);c<n.length;c++)s=n[c],t.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return t.O(u)},r=self["webpackChunkwebtodo"]=self["webpackChunkwebtodo"]||[];r.forEach(o.bind(null,0)),r.push=o.bind(null,r.push.bind(r))}();var r=t.O(void 0,[998],(function(){return t(1137)}));r=t.O(r)})();
//# sourceMappingURL=app.9d8e0ab9.js.map